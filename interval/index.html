<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mobile Interval Timer</title>
<script src="https://cdn.jsdelivr.net/npm/howler"></script>
<style>
:root {
  --bg:#F6F7FB;
  --text:#22194D;
  --prep:#FFAC1C;
  --work:#FC1500;
  --rest:#69FC00;
  --active:#5DADD5;
}
* { box-sizing: border-box; margin:0; padding:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif; }
body { background:var(--bg); color:var(--text); display:flex; flex-direction:column; min-height:100vh; }
main { flex:1; display:flex; flex-direction:column; align-items:center; padding:16px; width:100%; max-width:500px; margin:0 auto; }
.screen { border-radius:16px; padding:20px; width:100%; text-align:center; margin-bottom:16px; transition:background 0.3s; cursor:pointer; user-select:none; }
.digits { font-size:6rem; font-weight:900; margin:10px 0; }
.phase-label { font-weight:800; font-size:1.2rem; margin-bottom:6px; }
.status { font-weight:600; margin-bottom:12px; }
.bar-container { width:100%; background:#e7eef5; border-radius:12px; height:20px; overflow:hidden; margin-bottom:16px; }
.bar-fill { width:0%; height:100%; transition: width 0.15s linear; }
.btn-group { display:flex; justify-content:center; flex-wrap:wrap; margin-bottom:16px; gap:8px; }
.btn, .toggle { border:0; border-radius:999px; padding:12px 16px; font-weight:700; cursor:pointer; text-align:center; flex:1; }
.toggle { border:1px solid #cfd6df; background:#fff; transition:0.2s; }
.toggle.active { background:var(--active); color:#fff; border-color:var(--active); }
.round-settings { width:100%; margin-top:16px; }
.round-row { display:flex; gap:10px; align-items:center; padding:10px; background:#fff; border-radius:10px; border:1px solid #eef4f7; margin-bottom:8px; }
.round-row strong { min-width:60px; display:block; }
.round-row input { width:60px; border:1px solid #cfd6df; border-radius:8px; text-align:center; padding:4px; }
.footer-text { font-size:0.85rem; color:#666; text-align:center; margin-top:auto; margin-bottom:16px; }
input[type=range] { width:100%; margin:0 6px; }
</style>
</head>
<body>
<main>
  <div id="screen" class="screen prep">
    <div class="phase-label" id="phase-label">GET READY</div>
    <div class="digits" id="digits">00:10</div>
    <div class="status" id="status">Ready</div>
    <div class="bar-container"><div id="barFill" class="bar-fill"></div></div>
  </div>

  <div class="btn-group">
    <button id="muteBtn" class="toggle active">Mute: OFF</button>
    <button id="tickToggle" class="toggle active">Halfway Alert: ON</button>
    <button id="reverseBtn" class="toggle">Reverse: OFF</button>
    <button id="resetBtn" class="toggle">Reset</button>
  </div>

  <div style="width:100%; margin-bottom:16px;">
    <label>Rounds: <span id="roundsVal">4</span></label>
    <input id="roundsSlider" type="range" min="4" max="12" value="4">
  </div>
  <div style="width:100%; margin-bottom:16px;">
    <label>Prep Time (sec): <span id="prepVal">10</span></label>
    <input id="prepSlider" type="range" min="5" max="15" value="10">
  </div>

  <div id="roundSettings" class="round-settings"></div>
  <div class="footer-text">Tap the timer to Start/Pause. Customize rounds below.</div>
</main>

<script>
(function(){
const $=id=>document.getElementById(id);
const screen=$('screen'), digits=$('digits'), phaseLabel=$('phase-label'), status=$('status'), bar=$('barFill');
const tickToggle=$('tickToggle'), muteBtn=$('muteBtn'), reverseBtn=$('reverseBtn'), resetBtn=$('resetBtn');
const roundsSlider=$('roundsSlider'), prepSlider=$('prepSlider');
const roundsVal=$('roundsVal'), prepVal=$('prepVal');
const roundSettings=$('roundSettings');

let schedule=[], totalRounds=4, roundIndex=0, phase='prep', phaseSeconds=10, phaseTotal=10;
let running=false, lastTick=null, raf=null, prepActive=true, midTicked=false, midEnabled=true, muted=false, reverseMode=false;
let userInteracted=false;

// Default 4 rounds
const defaultSchedule=[
  {work:60,rest:60},
  {work:120,rest:120},
  {work:180,rest:120},
  {work:240,rest:180}
];

// Howler.js sounds
const beepShort=new Howl({src:['https://freesound.org/data/previews/66/66717_931655-lq.mp3'], volume:0.7});
const beepLong=new Howl({src:['https://freesound.org/data/previews/66/66717_931655-lq.mp3'], volume:1.0});
function playSound(type){if(muted) return; if(type==='short') beepShort.play(); else beepLong.play();}

function formatTime(s){s=Math.max(0,Math.floor(s));return String(Math.floor(s/60)).padStart(2,'0')+':'+String(s%60).padStart(2,'0');}
function updateBar(){const pct=phaseTotal?((phaseTotal-phaseSeconds)/phaseTotal)*100:0; bar.style.width=pct+'%';}

function renderRoundInputs(){
  roundSettings.innerHTML=''; totalRounds=Math.max(4,parseInt(roundsSlider.value)||4);
  for(let i=0;i<totalRounds;i++){
    const val=defaultSchedule[i]||{work:60,rest:60};
    const div=document.createElement('div'); div.className='round-row';
    div.innerHTML=`<strong>R${i+1}</strong>
      Work:<input type="number" min="1" id="w${i}" value="${val.work}">
      Rest:<input type="number" min="0" id="r${i}" value="${val.rest}">`;
    roundSettings.appendChild(div);
  }
}

function readSchedule(){
  schedule=[]; totalRounds=Math.max(4,parseInt(roundsSlider.value)||4);
  for(let i=0;i<totalRounds;i++){
    const w=parseInt($('w'+i)?.value)||60, r=parseInt($('r'+i)?.value)||60;
    schedule.push({work:w,rest:r});
  }
}

function setPhase(p){
  phase=p; midTicked=false; prepActive=(p==='prep'); const cur=schedule[roundIndex]||{work:60,rest:60};
  if(p==='prep'){phaseSeconds=parseInt(prepSlider.value)||10; phaseTotal=phaseSeconds; screen.style.background='#FFAC1C'; bar.style.background='#FFAC1C'; phaseLabel.textContent='GET READY'; status.textContent='Starting soon...';}
  else if(p==='work'){phaseSeconds=cur.work; phaseTotal=cur.work; screen.style.background='#FC1500'; bar.style.background='#FC1500'; phaseLabel.textContent='WORK'; status.textContent='Go!';}
  else {phaseSeconds=cur.rest; phaseTotal=cur.rest; screen.style.background='#69FC00'; bar.style.background='#69FC00'; phaseLabel.textContent='REST'; status.textContent='Recover';}
  digits.textContent=formatTime(phaseSeconds); updateBar();
}

function nextStep(){
  if(phase==='work' && (schedule[roundIndex]?.rest||0)>0){setPhase('rest'); return;}
  if(reverseMode){
    if(roundIndex>0){roundIndex--; setPhase('work');}else finishAll();
  }else{
    if(roundIndex+1<totalRounds){roundIndex++; setPhase('work');}else finishAll();
  }
}

function finishAll(){running=false; cancelAnimationFrame(raf); phaseLabel.textContent='DONE'; status.textContent='Complete!'; digits.textContent='00:00'; bar.style.width='100%'; playSound('long');}

function tick(ts){
  if(!running) { lastTick = ts; return; }
  if(!lastTick) lastTick = ts;
  const delta=(ts-lastTick)/1000; lastTick=ts; const prev=Math.ceil(phaseSeconds);
  phaseSeconds=Math.max(0,phaseSeconds-delta); const now=Math.ceil(phaseSeconds);
  if(!midTicked && phase==='work' && phaseTotal>0 && phaseSeconds<=phaseTotal/2 && midEnabled){playSound('short'); midTicked=true;}
  if(now!==prev){digits.textContent=formatTime(now); if(now>0&&now<=3){playSound('short');} if(now===0){playSound('long'); setTimeout(nextStep,650);} updateBar();}
  raf=requestAnimationFrame(tick);
}

// Timer click: start/pause and unlock audio
screen.addEventListener('click',()=>{
    if(!userInteracted){
        // Unlock Howler
        beepShort.play(); beepShort.stop();
        beepLong.play(); beepLong.stop();
        userInteracted=true;
    }
    running=!running;
    if(running){ lastTick = performance.now(); raf = requestAnimationFrame(tick); }
    status.textContent = running ? 'Running' : 'Paused';
});

// Buttons
tickToggle.addEventListener('click',()=>{midEnabled=!midEnabled; tickToggle.classList.toggle('active',midEnabled);});
muteBtn.addEventListener('click',()=>{muted=!muted; muteBtn.classList.toggle('active',!muted);});
reverseBtn.addEventListener('click',()=>{reverseMode=!reverseMode; reverseBtn.classList.toggle('active',reverseMode); resetTimer();});
resetBtn.addEventListener('click',resetTimer);

// Sliders
roundsSlider.addEventListener('input',()=>{roundsVal.textContent=roundsSlider.value; renderRoundInputs(); readSchedule(); resetTimer();});
prepSlider.addEventListener('input',()=>{prepVal.textContent=prepSlider.value; resetTimer();});

function resetTimer(){running=false; cancelAnimationFrame(raf); roundIndex=reverseMode?totalRounds-1:0; setPhase('prep'); digits.textContent=formatTime(parseInt(prepSlider.value)||10); status.textContent='Ready'; readSchedule();}
function init(){schedule=JSON.parse(JSON.stringify(defaultSchedule)); renderRoundInputs(); resetTimer();}
init();
})();
</script>
</body>
</html>
